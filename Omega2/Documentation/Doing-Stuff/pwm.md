---
title: PWM
layout: guide.hbs
columns: two
devices: [ Omega2 ]
order: 2
---

## Generating PWM signals

The Omega2 and Omega2S provide a number of ways to generate PWM signals.

The Omega module has a number of hardware PWM channels. The timing for these hardware based PWM channels will be highly accurate,
however these hardware PWM channels are only available on specific pins. It is also possible to generate a PWM signal via
a software application. Software PWM can use any GPIO pin but its accuracy is likely to be lower than the hardware PWM and
its timings can vary based upon system load.

[External hardware]{#expansion-external-pwm} such as the PWM Expansion Dock or other hardware based PWM ICs can be used to generate PWM signals.

### Module hardware generated

The Omega's SoC has a number of PWM modules. The Omega2 exposes two (2) PWM hardware modules on its pin headers while the Omega2S exposes all four (4).

> The hardware PWM modules have a range from 39Hz to 40MHz. For lower frequencies it is recommended to consider an external hardware PWM generator or the use of a software generated PWM signal from a GPIO pin.

#### Enabling PWM Pins
The Omega's pins are multiplexed allowing the exposed pins to be used for a number of different functions.

| PWM Channel | GPIO   | Pin | Notes          |
|-------------|--------|-----|----------------|
| 0           | GPIO18 |     |                |
| 1           | GPIO19 |     |                |
| 2           | GPIO20 | 51  |                |
| 3           | GPIO21 | 52  | `Omega2S only` |

The pin multiplexing configuration can be easily changed from the command line using `omega2-ctrl`.

For GPIO18:
```
omega2-ctrl gpiomux set pwm0 pwm
```

For GPIO19:
```
omega2-ctrl gpiomux set pwm1 pwm
```

For GPIO20:
```
omega2-ctrl gpiomux set pwm2 pwm
```

For GPIO21:
```
omega2-ctrl gpiomux set pwm3 pwms
```

> This multiplexing configuration will need to be repeated after each reboot of the Omega.

#### Enabling PWM signals

Once the appropriate pins have been configured for PWM usage we can configure the PWM hardware module to generate the pwm signal using the following command:
```
onion pwm <CHANNEL> <DUTY CYCLE> <FREQUENCY>
```

Where:
* CHANNEL is either 0 (GPIO18) or 1 (GPIO19)
* DUTY_CYCLE is the percentage of time the signal is 'on', expressed 0-100
* FREQUENCY is the signal frequency, expressed in Hz

#### Stopping the PWM signal

It is possible to disable the PWM signal:
```
onion pwm <CHANNEL disable>
```

### Module software generated
The fast-gpio utility can be used to generate a pwm signal using a GPIO pin. See [fast-gpio]{#using-fast-gpio-pwm}

### Expansion / external IC generated {#expansion-external-pwm}
The expansion module provides 16 pwm channels generated by a dedicated hardware PWM IC that interfaces via i2c.
> See [Using PWM Expansion]{#using-pwm-expansion} for details on the PWM expansion module.

### Programmatic hardware PWM

The Omega's PWM modules are exposed on Linux via sysfs. The [sysfs PWM interface](https://www.kernel.org/doc/Documentation/pwm.txt)
provides a standardized way to expose PWM hardware for programmatic control from userspace applications.

You can find the PWM chip directories at:

```
/sys/class/pwm
```

```
root@Omega-C0FB:/# ls /sys/class/pwm
pwmchip0
```
